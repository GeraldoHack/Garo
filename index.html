<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rede Social Escolar</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4285F4;
            --secondary-color: #34A853;
            --danger-color: #EA4335;
            --warning-color: #FBBC05;
            --light-color: #f5f5f5;
            --dark-color: #333;
            --gray-color: #757575;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }

        body {
            background-color: #f9f9f9;
            color: var(--dark-color);
        }

        #app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* Header Styles */
        .app-header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 10;
        }

        .header-title {
            font-size: 1.5rem;
            font-weight: 500;
        }

        .header-actions {
            display: flex;
            gap: 15px;
        }

        .icon-button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            transition: margin-left 0.3s;
        }

        /* Drawer Menu Styles */
        .drawer {
            position: fixed;
            top: 0;
            left: -300px;
            width: 300px;
            height: 100%;
            background-color: white;
            box-shadow: 2px 0 5px rgba(0,0,0,0.2);
            z-index: 100;
            transition: left 0.3s;
            display: flex;
            flex-direction: column;
        }

        .drawer.open {
            left: 0;
        }

        .drawer-header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .drawer-user {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--light-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--gray-color);
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-weight: 500;
            font-size: 1.1rem;
        }

        .user-email {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .drawer-menu {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }

        .menu-item {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .menu-item:hover {
            background-color: rgba(0,0,0,0.05);
        }

        .menu-item.active {
            background-color: rgba(66, 133, 244, 0.1);
            color: var(--primary-color);
        }

        .menu-item i {
            font-size: 1.2rem;
        }

        .drawer-footer {
            padding: 15px;
            border-top: 1px solid rgba(0,0,0,0.1);
            text-align: center;
            font-size: 0.8rem;
            color: var(--gray-color);
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 99;
            display: none;
        }

        .overlay.visible {
            display: block;
        }

        /* Auth Styles */
        .auth-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            padding: 20px;
            background-color: var(--light-color);
        }

        .auth-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 30px;
            width: 100%;
            max-width: 400px;
        }

        .auth-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            text-align: center;
            color: var(--primary-color);
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .form-label {
            font-size: 0.9rem;
            color: var(--gray-color);
        }

        .form-input {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-input:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .form-select {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            background-color: white;
        }

        .auth-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 10px;
        }

        .auth-button:hover {
            background-color: #3367d6;
        }

        .auth-divider {
            display: flex;
            align-items: center;
            margin: 20px 0;
            color: var(--gray-color);
        }

        .auth-divider::before, .auth-divider::after {
            content: "";
            flex: 1;
            border-bottom: 1px solid #ddd;
        }

        .auth-divider::before {
            margin-right: 10px;
        }

        .auth-divider::after {
            margin-left: 10px;
        }

        .google-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            background-color: white;
            color: var(--dark-color);
            border: 1px solid #ddd;
            padding: 12px;
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .google-button:hover {
            background-color: #f5f5f5;
        }

        .auth-footer {
            margin-top: 20px;
            text-align: center;
            font-size: 0.9rem;
            color: var(--gray-color);
        }

        .auth-link {
            color: var(--primary-color);
            text-decoration: none;
            cursor: pointer;
        }

        .auth-link:hover {
            text-decoration: underline;
        }

        /* Feed Styles */
        .feed-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .post-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 15px;
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .post-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--light-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-color);
            cursor: pointer;
        }

        .post-user {
            flex: 1;
        }

        .post-name {
            font-weight: 500;
            cursor: pointer;
        }

        .post-time {
            font-size: 0.8rem;
            color: var(--gray-color);
        }

        .post-content {
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .post-actions {
            display: flex;
            gap: 15px;
            border-top: 1px solid #eee;
            padding-top: 10px;
        }

        .post-action {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--gray-color);
            font-size: 0.9rem;
            cursor: pointer;
        }

        .post-action.liked {
            color: var(--primary-color);
        }

        .post-action:hover {
            color: var(--primary-color);
        }

        .create-post {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 15px;
            margin-bottom: 15px;
        }

        .post-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            margin-bottom: 10px;
            resize: none;
            min-height: 80px;
        }

        .post-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .post-button:hover {
            background-color: #3367d6;
        }

        /* Comments Styles */
        .comments-container {
            margin-top: 10px;
            border-top: 1px solid #eee;
            padding-top: 10px;
            display: none;
        }

        .comment {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .comment-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: var(--light-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            color: var(--gray-color);
            cursor: pointer;
        }

        .comment-content {
            flex: 1;
            background-color: #f5f5f5;
            padding: 8px 12px;
            border-radius: 12px;
        }

        .comment-user {
            font-weight: 500;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .comment-text {
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .comment-time {
            font-size: 0.7rem;
            color: var(--gray-color);
            margin-top: 3px;
        }

        .add-comment {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .comment-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .comment-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Chat Styles */
        .chat-container {
            display: none;
            flex-direction: column;
            height: 100%;
        }

        .chat-header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chat-back {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.5rem;
        }

        .chat-title {
            flex: 1;
            font-size: 1.1rem;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background-color: #f5f5f5;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .message {
            max-width: 70%;
            padding: 10px 15px;
            border-radius: 18px;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .message-sent {
            align-self: flex-end;
            background-color: var(--primary-color);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message-received {
            align-self: flex-start;
            background-color: white;
            color: var(--dark-color);
            border: 1px solid #ddd;
            border-bottom-left-radius: 4px;
        }

        .message-time {
            font-size: 0.7rem;
            opacity: 0.7;
            margin-top: 3px;
            text-align: right;
        }

        .chat-input-container {
            display: flex;
            padding: 10px;
            background-color: white;
            border-top: 1px solid #ddd;
        }

        .chat-input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 1rem;
            margin-right: 10px;
        }

        .chat-send {
            background-color: var(--primary-color);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Communities Styles */
        .communities-container {
            display: none;
            flex-direction: column;
            gap: 15px;
        }

        .community-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
        }

        .community-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--light-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            font-size: 1.5rem;
        }

        .community-info {
            flex: 1;
        }

        .community-name {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .community-members {
            font-size: 0.8rem;
            color: var(--gray-color);
        }

        .create-community {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 15px;
            margin-bottom: 15px;
        }

        .community-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            margin-bottom: 10px;
        }

        /* Friends Styles */
        .friends-container {
            display: none;
            flex-direction: column;
            gap: 15px;
        }

        .friend-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .friend-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--light-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-color);
            cursor: pointer;
        }

        .friend-info {
            flex: 1;
        }

        .friend-name {
            font-weight: 500;
            margin-bottom: 5px;
            cursor: pointer;
        }

        .friend-class {
            font-size: 0.8rem;
            color: var(--gray-color);
        }

        .friend-actions {
            display: flex;
            gap: 10px;
        }

        .friend-button {
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            border: none;
        }

        .friend-button.primary {
            background-color: var(--primary-color);
            color: white;
        }

        .friend-button.secondary {
            background-color: var(--light-color);
            color: var(--dark-color);
        }

        /* Profile Styles */
        .profile-container {
            display: none;
            flex-direction: column;
        }

        .profile-header {
            background-color: var(--primary-color);
            color: white;
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: var(--light-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: var(--gray-color);
            cursor: pointer;
        }

        .profile-name {
            font-size: 1.5rem;
            font-weight: 500;
        }

        .profile-email {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .profile-content {
            padding: 20px;
            flex: 1;
        }

        .profile-section {
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .profile-info {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .info-item {
            display: flex;
            gap: 10px;
        }

        .info-label {
            font-weight: 500;
            min-width: 100px;
        }

        .edit-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            font-size: 0.9rem;
            cursor: pointer;
            margin-top: 10px;
        }

        /* Edit Profile Styles */
        .edit-profile-container {
            display: none;
            flex-direction: column;
            padding: 20px;
        }

        .edit-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-group {
            flex: 1;
        }

        /* Settings Styles */
        .settings-container {
            display: none;
            flex-direction: column;
            padding: 20px;
        }

        .settings-item {
            padding: 15px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .settings-item:last-child {
            border-bottom: none;
        }

        .settings-item i {
            color: var(--gray-color);
        }

        /* Bottom Navigation */
        .bottom-nav {
            display: none;
            background-color: white;
            border-top: 1px solid #ddd;
            padding: 10px 0;
            position: sticky;
            bottom: 0;
            z-index: 10;
        }

        .nav-items {
            display: flex;
            justify-content: space-around;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            color: var(--gray-color);
            text-decoration: none;
            font-size: 0.8rem;
        }

        .nav-item.active {
            color: var(--primary-color);
        }

        .nav-icon {
            font-size: 1.5rem;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 200;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 500;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .drawer {
                width: 80%;
                left: -80%;
            }
            
            .bottom-nav {
                display: block;
            }
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .visible {
            display: flex !important;
        }

        .text-center {
            text-align: center;
        }

        .mt-10 {
            margin-top: 10px;
        }

        .mb-10 {
            margin-bottom: 10px;
        }

        .full-width {
            width: 100%;
        }

        .loading {
            display: flex;
            justify-content: center;
            padding: 20px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0,0,0,0.1);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="app-container">
        <!-- Auth Screens -->
        <div id="auth-screen" class="auth-container">
            <div class="auth-card">
                <h1 class="auth-title">Bem-vindo</h1>
                <form id="login-form" class="auth-form">
                    <div class="form-group">
                        <label for="login-email" class="form-label">Email</label>
                        <input type="email" id="login-email" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password" class="form-label">Senha</label>
                        <input type="password" id="login-password" class="form-input" required>
                    </div>
                    <button type="submit" class="auth-button">Entrar</button>
                </form>
                
                <div class="auth-divider">ou</div>
                
                <button id="google-login" class="google-button">
                    <i class="material-icons">account_circle</i>
                    Entrar com Google
                </button>
                
                <div class="auth-footer">
                    Não tem uma conta? <a id="show-register" class="auth-link">Registre-se</a>
                </div>
            </div>
        </div>
        
        <div id="register-screen" class="auth-container hidden">
            <div class="auth-card">
                <h1 class="auth-title">Criar Conta</h1>
                <form id="register-form" class="auth-form">
                    <div class="form-group">
                        <label for="register-name" class="form-label">Nome Completo</label>
                        <input type="text" id="register-name" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="register-email" class="form-label">Email</label>
                        <input type="email" id="register-email" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="register-password" class="form-label">Senha</label>
                        <input type="password" id="register-password" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="register-confirm" class="form-label">Confirmar Senha</label>
                        <input type="password" id="register-confirm" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="register-class" class="form-label">Turma</label>
                        <select id="register-class" class="form-select" required>
                            <option value="">Selecione sua turma</option>
                            <option value="7">7ª Classe</option>
                            <option value="8">8ª Classe</option>
                            <option value="9">9ª Classe</option>
                            <option value="10">10ª Classe</option>
                            <option value="11">11ª Classe</option>
                            <option value="12">12ª Classe</option>
                        </select>
                    </div>
                    <button type="submit" class="auth-button">Registrar</button>
                </form>
                
                <div class="auth-footer">
                    Já tem uma conta? <a id="show-login" class="auth-link">Faça login</a>
                </div>
            </div>
        </div>
        
        <!-- Main App -->
        <div id="app-main" class="hidden">
            <!-- Header -->
            <header class="app-header">
                <button id="menu-button" class="icon-button">
                    <i class="material-icons">menu</i>
                </button>
                <h1 class="header-title" id="page-title">Feed</h1>
                <div class="header-actions">
                    <button class="icon-button">
                        <i class="material-icons">search</i>
                    </button>
                    <button class="icon-button">
                        <i class="material-icons">notifications</i>
                    </button>
                </div>
            </header>
            
            <!-- Drawer Menu -->
            <div class="drawer" id="drawer">
                <div class="drawer-header">
                    <div class="drawer-user">
                        <div class="user-avatar" id="user-avatar">U</div>
                        <div class="user-info">
                            <div class="user-name" id="user-name">Usuário</div>
                            <div class="user-email" id="user-email">usuario@escola.com</div>
                        </div>
                    </div>
                </div>
                
                <div class="drawer-menu">
                    <div class="menu-item active" data-page="feed">
                        <i class="material-icons">home</i>
                        <span>Feed</span>
                    </div>
                    <div class="menu-item" data-page="friends">
                        <i class="material-icons">people</i>
                        <span>Amigos</span>
                    </div>
                    <div class="menu-item" data-page="communities">
                        <i class="material-icons">groups</i>
                        <span>Comunidades</span>
                    </div>
                    <div class="menu-item" data-page="chat">
                        <i class="material-icons">chat</i>
                        <span>Mensagens</span>
                    </div>
                    <div class="menu-item" data-page="profile">
                        <i class="material-icons">person</i>
                        <span>Perfil</span>
                    </div>
                    <div class="menu-item" data-page="settings">
                        <i class="material-icons">settings</i>
                        <span>Configurações</span>
                    </div>
                </div>
                
                <div class="drawer-footer">
                    <div class="menu-item" id="logout-button">
                        <i class="material-icons">logout</i>
                        <span>Sair</span>
                    </div>
                    <div>Rede Social Escolar v1.0</div>
                </div>
            </div>
            
            <div class="overlay" id="overlay"></div>
            
            <!-- Main Content -->
            <div class="main-content">
                <!-- Feed Page -->
                <div id="feed-page">
                    <div class="create-post">
                        <textarea class="post-input" placeholder="O que você está estudando hoje?"></textarea>
                        <button class="post-button" id="create-post-button">Postar</button>
                    </div>
                    
                    <div class="feed-container" id="posts-container">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Friends Page -->
                <div id="friends-page" class="friends-container hidden">
                    <div class="create-post">
                        <input type="text" class="post-input" id="search-friends" placeholder="Pesquisar amigos...">
                    </div>
                    
                    <div id="friends-list">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Communities Page -->
                <div id="communities-page" class="communities-container hidden">
                    <div class="create-community">
                        <input type="text" class="community-input" id="community-name" placeholder="Nome da comunidade">
                        <button class="post-button" id="create-community-button">Criar Comunidade</button>
                    </div>
                    
                    <div id="communities-list">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Chat Page -->
                <div id="chat-page" class="chat-container hidden">
                    <div class="chat-header">
                        <button class="chat-back" id="chat-back">
                            <i class="material-icons">arrow_back</i>
                        </button>
                        <div class="chat-title">Conversas</div>
                    </div>
                    
                    <div id="conversations-list" style="flex: 1; overflow-y: auto;">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Chat Conversation Page -->
                <div id="conversation-page" class="chat-container hidden">
                    <div class="chat-header">
                        <button class="chat-back" id="conversation-back">
                            <i class="material-icons">arrow_back</i>
                        </button>
                        <div class="chat-title" id="conversation-title">Chat</div>
                    </div>
                    
                    <div class="chat-messages" id="chat-messages">
                        <!-- Messages will be loaded here -->
                    </div>
                    
                    <div class="chat-input-container">
                        <input type="text" class="chat-input" id="message-input" placeholder="Digite uma mensagem...">
                        <button class="chat-send" id="send-message">
                            <i class="material-icons">send</i>
                        </button>
                    </div>
                </div>
                
                <!-- Profile Page -->
                <div id="profile-page" class="profile-container hidden">
                    <div class="profile-header">
                        <div class="profile-avatar" id="profile-avatar">U</div>
                        <div class="profile-name" id="profile-name">Usuário</div>
                        <div class="profile-email" id="profile-email">usuario@escola.com</div>
                    </div>
                    
                    <div class="profile-content">
                        <div class="profile-section">
                            <h3 class="section-title">Informações</h3>
                            <div class="profile-info">
                                <div class="info-item">
                                    <span class="info-label">Turma:</span>
                                    <span id="profile-class">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Matrícula:</span>
                                    <span id="profile-id">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Desde:</span>
                                    <span id="profile-since">-</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="profile-section">
                            <h3 class="section-title">Estatísticas</h3>
                            <div class="profile-info">
                                <div class="info-item">
                                    <span class="info-label">Posts:</span>
                                    <span id="profile-posts">0</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Amigos:</span>
                                    <span id="profile-friends">0</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Comunidades:</span>
                                    <span id="profile-communities">0</span>
                                </div>
                            </div>
                        </div>
                        
                        <button class="edit-button" id="edit-profile-button">Editar Perfil</button>
                    </div>
                </div>
                
                <!-- Edit Profile Page -->
                <div id="edit-profile-page" class="edit-profile-container hidden">
                    <div class="profile-section">
                        <h3 class="section-title">Editar Perfil</h3>
                        <form class="edit-form" id="edit-profile-form">
                            <div class="form-group">
                                <label for="edit-name" class="form-label">Nome</label>
                                <input type="text" id="edit-name" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label for="edit-class" class="form-label">Turma</label>
                                <select id="edit-class" class="form-select" required>
                                    <option value="7">7ª Classe</option>
                                    <option value="8">8ª Classe</option>
                                    <option value="9">9ª Classe</option>
                                    <option value="10">10ª Classe</option>
                                    <option value="11">11ª Classe</option>
                                    <option value="12">12ª Classe</option>
                                </select>
                            </div>
                            <button type="submit" class="edit-button">Salvar Alterações</button>
                        </form>
                    </div>
                </div>
                
                <!-- Settings Page -->
                <div id="settings-page" class="settings-container hidden">
                    <div class="settings-item" id="about-app">
                        <span>Sobre o Aplicativo</span>
                        <i class="material-icons">chevron_right</i>
                    </div>
                    <div class="settings-item" id="privacy-policy">
                        <span>Política de Privacidade</span>
                        <i class="material-icons">chevron_right</i>
                    </div>
                    <div class="settings-item" id="terms-of-use">
                        <span>Termos de Uso</span>
                        <i class="material-icons">chevron_right</i>
                    </div>
                    <div class="settings-item" id="help-support">
                        <span>Ajuda e Suporte</span>
                        <i class="material-icons">chevron_right</i>
                    </div>
                </div>
            </div>
            
            <!-- Bottom Navigation (Mobile) -->
            <nav class="bottom-nav">
                <div class="nav-items">
                    <a href="#" class="nav-item active" data-page="feed">
                        <i class="material-icons nav-icon">home</i>
                        <span>Feed</span>
                    </a>
                    <a href="#" class="nav-item" data-page="friends">
                        <i class="material-icons nav-icon">people</i>
                        <span>Amigos</span>
                    </a>
                    <a href="#" class="nav-item" data-page="communities">
                        <i class="material-icons nav-icon">groups</i>
                        <span>Comunidades</span>
                    </a>
                    <a href="#" class="nav-item" data-page="chat">
                        <i class="material-icons nav-icon">chat</i>
                        <span>Chat</span>
                    </a>
                </div>
            </nav>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="about-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Sobre o Aplicativo</h3>
                <button class="modal-close" id="close-about">&times;</button>
            </div>
            <div class="modal-body">
                <p>Rede Social Escolar v1.0</p>
                <p>Este aplicativo foi desenvolvido para facilitar a comunicação entre alunos e professores, permitindo o compartilhamento de dúvidas, conhecimentos e a formação de comunidades de estudo.</p>
                <p>Todos os direitos reservados &copy; 2023</p>
            </div>
        </div>
    </div>

    <div class="modal" id="privacy-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Política de Privacidade</h3>
                <button class="modal-close" id="close-privacy">&times;</button>
            </div>
            <div class="modal-body">
                <h4>1. Informações coletadas</h4>
                <p>Coletamos informações que você nos fornece ao criar uma conta, como nome, e-mail e turma. Também coletamos conteúdo que você posta em nossa plataforma.</p>
                
                <h4>2. Uso das informações</h4>
                <p>Utilizamos suas informações para fornecer e melhorar nossos serviços, personalizar sua experiência e permitir a comunicação entre usuários.</p>
                
                <h4>3. Compartilhamento de informações</h4>
                <p>Suas informações pessoais não serão compartilhadas com terceiros sem seu consentimento, exceto quando exigido por lei.</p>
                
                <h4>4. Segurança</h4>
                <p>Implementamos medidas de segurança para proteger suas informações contra acesso não autorizado.</p>
            </div>
        </div>
    </div>

    <div class="modal" id="terms-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Termos de Uso</h3>
                <button class="modal-close" id="close-terms">&times;</button>
            </div>
            <div class="modal-body">
                <h4>1. Aceitação dos Termos</h4>
                <p>Ao usar este aplicativo, você concorda com estes Termos de Uso e com nossa Política de Privacidade.</p>
                
                <h4>2. Uso Adequado</h4>
                <p>Você concorda em não usar este aplicativo para:</p>
                <ul>
                    <li>Publicar conteúdo ofensivo ou inapropriado</li>
                    <li>Assediar outros usuários</li>
                    <li>Violar direitos autorais</li>
                    <li>Realizar atividades ilegais</li>
                </ul>
                
                <h4>3. Responsabilidade</h4>
                <p>Você é responsável por todo o conteúdo que postar e por qualquer consequência decorrente desse conteúdo.</p>
                
                <h4>4. Modificações</h4>
                <p>Podemos modificar estes Termos a qualquer momento. O uso continuado do aplicativo após tais modificações constitui sua aceitação dos novos Termos.</p>
            </div>
        </div>
    </div>

    <div class="modal" id="help-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Ajuda e Suporte</h3>
                <button class="modal-close" id="close-help">&times;</button>
            </div>
            <div class="modal-body">
                <h4>Como usar o aplicativo</h4>
                <p><strong>Feed:</strong> Veja as postagens de outros alunos e publique suas próprias dúvidas ou conhecimentos.</p>
                <p><strong>Amigos:</strong> Adicione amigos para conversar e ver suas postagens.</p>
                <p><strong>Comunidades:</strong> Participe de comunidades de estudo ou crie a sua própria.</p>
                <p><strong>Chat:</strong> Converse em tempo real com seus amigos.</p>
                
                <h4>Problemas comuns</h4>
                <p><strong>Não consigo fazer login:</strong> Verifique se seu e-mail e senha estão corretos. Caso tenha esquecido sua senha, entre em contato com o administrador.</p>
                <p><strong>Não estou recebendo notificações:</strong> Verifique as configurações de notificação do seu dispositivo.</p>
                
                <h4>Contato</h4>
                <p>Para mais ajuda, entre em contato com o suporte técnico da sua escola.</p>
            </div>
        </div>
    </div>

    <!-- Firebase and App Script -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCi50dUOWrN5cT_XVUCE2qYGx_cIntLU8U",
            authDomain: "comunidade-ac59a.firebaseapp.com",
            databaseURL: "https://comunidade-ac59a-default-rtdb.firebaseio.com",
            projectId: "comunidade-ac59a",
            storageBucket: "comunidade-ac59a.firebasestorage.app",
            messagingSenderId: "291854946319",
            appId: "1:291854946319:web:8e952bc83c7c4fcb95d37a",
            measurementId: "G-PM3NP5DQ7G"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // DOM Elements
        const authScreen = document.getElementById('auth-screen');
        const registerScreen = document.getElementById('register-screen');
        const appMain = document.getElementById('app-main');
        const showRegister = document.getElementById('show-register');
        const showLogin = document.getElementById('show-login');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const googleLogin = document.getElementById('google-login');
        const logoutButton = document.getElementById('logout-button');
        const menuButton = document.getElementById('menu-button');
        const drawer = document.getElementById('drawer');
        const overlay = document.getElementById('overlay');
        const pageTitle = document.getElementById('page-title');
        const userAvatar = document.getElementById('user-avatar');
        const userName = document.getElementById('user-name');
        const userEmail = document.getElementById('user-email');
        const profileAvatar = document.getElementById('profile-avatar');
        const profileName = document.getElementById('profile-name');
        const profileEmail = document.getElementById('profile-email');
        const editProfileButton = document.getElementById('edit-profile-button');
        const editProfileForm = document.getElementById('edit-profile-form');
        
        // Page Elements
        const feedPage = document.getElementById('feed-page');
        const friendsPage = document.getElementById('friends-page');
        const communitiesPage = document.getElementById('communities-page');
        const chatPage = document.getElementById('chat-page');
        const conversationPage = document.getElementById('conversation-page');
        const profilePage = document.getElementById('profile-page');
        const editProfilePage = document.getElementById('edit-profile-page');
        const settingsPage = document.getElementById('settings-page');
        
        // Posts
        const postsContainer = document.getElementById('posts-container');
        const createPostButton = document.getElementById('create-post-button');
        const postInput = document.querySelector('.post-input');
        
        // Friends
        const friendsList = document.getElementById('friends-list');
        const searchFriendsInput = document.getElementById('search-friends');
        
        // Communities
        const communitiesList = document.getElementById('communities-list');
        const createCommunityButton = document.getElementById('create-community-button');
        const communityNameInput = document.getElementById('community-name');
        
        // Chat
        const conversationsList = document.getElementById('conversations-list');
        const chatMessages = document.getElementById('chat-messages');
        const messageInput = document.getElementById('message-input');
        const sendMessageButton = document.getElementById('send-message');
        const chatBackButton = document.getElementById('chat-back');
        const conversationBackButton = document.getElementById('conversation-back');
        const conversationTitle = document.getElementById('conversation-title');
        
        // Profile
        const profileClass = document.getElementById('profile-class');
        const profileId = document.getElementById('profile-id');
        const profileSince = document.getElementById('profile-since');
        const profilePosts = document.getElementById('profile-posts');
        const profileFriends = document.getElementById('profile-friends');
        const profileCommunities = document.getElementById('profile-communities');
        const editNameInput = document.getElementById('edit-name');
        const editClassSelect = document.getElementById('edit-class');
        
        // Modals
        const aboutModal = document.getElementById('about-modal');
        const privacyModal = document.getElementById('privacy-modal');
        const termsModal = document.getElementById('terms-modal');
        const helpModal = document.getElementById('help-modal');
        const closeAbout = document.getElementById('close-about');
        const closePrivacy = document.getElementById('close-privacy');
        const closeTerms = document.getElementById('close-terms');
        const closeHelp = document.getElementById('close-help');
        const aboutApp = document.getElementById('about-app');
        const privacyPolicy = document.getElementById('privacy-policy');
        const termsOfUse = document.getElementById('terms-of-use');
        const helpSupport = document.getElementById('help-support');
        
        // Menu Items
        const menuItems = document.querySelectorAll('.menu-item');
        const navItems = document.querySelectorAll('.nav-item');
        
        // App State
        let currentUser = null;
        let currentPage = 'feed';
        let currentConversation = null;
        let friends = [];
        let friendRequests = [];
        let communities = [];
        let posts = [];
        let users = {};
        let conversations = {};
        
        // Initialize the app
        function initApp() {
            // Auth state listener
            auth.onAuthStateChanged(user => {
                if (user) {
                    // User is signed in
                    currentUser = user;
                    authScreen.classList.add('hidden');
                    registerScreen.classList.add('hidden');
                    appMain.classList.remove('hidden');
                    
                    // Update user info
                    updateUserInfo(user);
                    
                    // Load user data from database
                    loadUserData(user.uid);
                    
                    // Load initial page
                    showPage(currentPage);
                } else {
                    // User is signed out
                    currentUser = null;
                    authScreen.classList.remove('hidden');
                    registerScreen.classList.add('hidden');
                    appMain.classList.add('hidden');
                }
            });
            
            // Load modals
            setupModals();
        }
        
        // Setup modal event listeners
        function setupModals() {
            aboutApp.addEventListener('click', () => aboutModal.style.display = 'flex');
            privacyPolicy.addEventListener('click', () => privacyModal.style.display = 'flex');
            termsOfUse.addEventListener('click', () => termsModal.style.display = 'flex');
            helpSupport.addEventListener('click', () => helpModal.style.display = 'flex');
            
            closeAbout.addEventListener('click', () => aboutModal.style.display = 'none');
            closePrivacy.addEventListener('click', () => privacyModal.style.display = 'none');
            closeTerms.addEventListener('click', () => termsModal.style.display = 'none');
            closeHelp.addEventListener('click', () => helpModal.style.display = 'none');
            
            // Close modal when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === aboutModal) aboutModal.style.display = 'none';
                if (e.target === privacyModal) privacyModal.style.display = 'none';
                if (e.target === termsModal) termsModal.style.display = 'none';
                if (e.target === helpModal) helpModal.style.display = 'none';
            });
        }
        
        // Update user info in UI
        function updateUserInfo(user) {
            const displayName = user.displayName || 'Usuário';
            const email = user.email || 'usuario@escola.com';
            const firstLetter = displayName.charAt(0).toUpperCase();
            
            // Update header and drawer
            userAvatar.textContent = firstLetter;
            userName.textContent = displayName;
            userEmail.textContent = email;
            
            // Update profile
            profileAvatar.textContent = firstLetter;
            profileName.textContent = displayName;
            profileEmail.textContent = email;
            
            // Set edit profile form values
            editNameInput.value = displayName;
        }
        
        // Load user data from database
        function loadUserData(userId) {
            // Load user profile
            database.ref('users/' + userId).once('value').then(snapshot => {
                const userData = snapshot.val();
                if (userData) {
                    // Update profile info
                    profileClass.textContent = getClassName(userData.class) || '-';
                    profileId.textContent = userId.substring(0, 8);
                    
                    // Format join date
                    if (userData.joinDate) {
                        const joinDate = new Date(userData.joinDate);
                        profileSince.textContent = joinDate.toLocaleDateString('pt-BR');
                    } else {
                        profileSince.textContent = 'Novembro 2023';
                    }
                    
                    // Set class in edit form
                    if (userData.class) {
                        editClassSelect.value = userData.class;
                    }
                }
            });
            
            // Load friends
            database.ref('friends/' + userId).on('value', snapshot => {
                friends = [];
                const friendsData = snapshot.val();
                if (friendsData) {
                    Object.keys(friendsData).forEach(friendId => {
                        if (friendsData[friendId] === 'accepted') {
                            friends.push(friendId);
                        }
                    });
                }
                profileFriends.textContent = friends.length;
                if (currentPage === 'friends') {
                    loadFriendsList();
                }
            });
            
            // Load friend requests
            database.ref('friendRequests/' + userId).on('value', snapshot => {
                friendRequests = [];
                const requestsData = snapshot.val();
                if (requestsData) {
                    Object.keys(requestsData).forEach(requestId => {
                        if (requestsData[requestId] === 'pending') {
                            friendRequests.push(requestId);
                        }
                    });
                }
                if (currentPage === 'friends') {
                    loadFriendsList();
                }
            });
            
            // Load communities
            database.ref('userCommunities/' + userId).on('value', snapshot => {
                communities = [];
                const communitiesData = snapshot.val();
                if (communitiesData) {
                    Object.keys(communitiesData).forEach(communityId => {
                        communities.push(communityId);
                    });
                }
                profileCommunities.textContent = communities.length;
                if (currentPage === 'communities') {
                    loadCommunitiesList();
                }
            });
            
            // Load posts
            database.ref('posts').orderByChild('timestamp').limitToLast(20).on('value', snapshot => {
                posts = [];
                const postsData = snapshot.val();
                if (postsData) {
                    Object.keys(postsData).forEach(postId => {
                        posts.unshift({
                            id: postId,
                            ...postsData[postId]
                        });
                    });
                }
                profilePosts.textContent = posts.filter(post => post.authorId === userId).length;
                if (currentPage === 'feed') {
                    loadPosts();
                }
            });
            
            // Load conversations
            database.ref('userConversations/' + userId).on('value', snapshot => {
                conversations = {};
                const conversationsData = snapshot.val();
                if (conversationsData) {
                    Object.keys(conversationsData).forEach(conversationId => {
                        conversations[conversationId] = conversationsData[conversationId];
                    });
                }
                if (currentPage === 'chat') {
                    loadConversationsList();
                }
            });
            
            // Load users data
            database.ref('users').on('value', snapshot => {
                users = snapshot.val() || {};
            });
        }
        
        // Get class name from class number
        function getClassName(classNum) {
            const classes = {
                '7': '7ª Classe',
                '8': '8ª Classe',
                '9': '9ª Classe',
                '10': '10ª Classe',
                '11': '11ª Classe',
                '12': '12ª Classe'
            };
            return classes[classNum] || '-';
        }
        
        // Show page
        function showPage(page) {
            currentPage = page;
            
            // Hide all pages
            feedPage.classList.add('hidden');
            friendsPage.classList.add('hidden');
            communitiesPage.classList.add('hidden');
            chatPage.classList.add('hidden');
            conversationPage.classList.add('hidden');
            profilePage.classList.add('hidden');
            editProfilePage.classList.add('hidden');
            settingsPage.classList.add('hidden');
            
            // Update active menu items
            menuItems.forEach(item => {
                if (item.dataset.page === page) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            navItems.forEach(item => {
                if (item.dataset.page === page) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            // Show selected page and load data
            switch(page) {
                case 'feed':
                    feedPage.classList.remove('hidden');
                    pageTitle.textContent = 'Feed';
                    loadPosts();
                    break;
                case 'friends':
                    friendsPage.classList.remove('hidden');
                    pageTitle.textContent = 'Amigos';
                    loadFriendsList();
                    break;
                case 'communities':
                    communitiesPage.classList.remove('hidden');
                    pageTitle.textContent = 'Comunidades';
                    loadCommunitiesList();
                    break;
                case 'chat':
                    chatPage.classList.remove('hidden');
                    pageTitle.textContent = 'Mensagens';
                    loadConversationsList();
                    break;
                case 'profile':
                    profilePage.classList.remove('hidden');
                    pageTitle.textContent = 'Perfil';
                    break;
                case 'settings':
                    settingsPage.classList.remove('hidden');
                    pageTitle.textContent = 'Configurações';
                    break;
            }
        }
        
        // Load posts
        function loadPosts() {
            if (posts.length === 0) {
                postsContainer.innerHTML = '<p class="text-center">Nenhum post encontrado. Seja o primeiro a postar!</p>';
                return;
            }
            
            postsContainer.innerHTML = '';
            
            posts.forEach(post => {
                const postDate = new Date(post.timestamp);
                const postCard = document.createElement('div');
                postCard.className = 'post-card';
                postCard.dataset.postId = post.id;
                
                // Get author data
                const author = users[post.authorId] || { displayName: post.author, class: '' };
                
                postCard.innerHTML = `
                    <div class="post-header">
                        <div class="post-avatar" data-user-id="${post.authorId}">${author.displayName ? author.displayName.charAt(0).toUpperCase() : 'U'}</div>
                        <div class="post-user">
                            <div class="post-name" data-user-id="${post.authorId}">${author.displayName || post.author}</div>
                            <div class="post-time">${formatTime(postDate)}</div>
                        </div>
                    </div>
                    <div class="post-content">${post.content}</div>
                    <div class="post-actions">
                        <div class="post-action like-button ${post.likes && post.likes[currentUser.uid] ? 'liked' : ''}">
                            <i class="material-icons">thumb_up</i>
                            <span class="like-count">${post.likes ? Object.keys(post.likes).length : 0}</span>
                        </div>
                        <div class="post-action comment-button">
                            <i class="material-icons">comment</i>
                            <span class="comment-count">${post.comments ? Object.keys(post.comments).length : 0}</span>
                        </div>
                    </div>
                    <div class="comments-container">
                        <div class="comments-list"></div>
                        <div class="add-comment">
                            <input type="text" class="comment-input" placeholder="Escreva um comentário...">
                            <button class="comment-button">
                                <i class="material-icons">send</i>
                            </button>
                        </div>
                    </div>
                `;
                
                postsContainer.appendChild(postCard);
                
                // Add event listeners
                const likeButton = postCard.querySelector('.like-button');
                const commentButton = postCard.querySelector('.comment-button');
                const commentsContainer = postCard.querySelector('.comments-container');
                const commentInput = postCard.querySelector('.comment-input');
                const sendCommentButton = postCard.querySelector('.comment-button');
                
                likeButton.addEventListener('click', () => toggleLike(post.id));
                commentButton.addEventListener('click', () => {
                    commentsContainer.style.display = commentsContainer.style.display === 'block' ? 'none' : 'block';
                    loadComments(post.id, postCard.querySelector('.comments-list'));
                });
                
                sendCommentButton.addEventListener('click', () => {
                    const commentText = commentInput.value.trim();
                    if (commentText) {
                        addComment(post.id, commentText);
                        commentInput.value = '';
                    }
                });
                
                // User avatar/name click
                postCard.querySelectorAll('[data-user-id]').forEach(el => {
                    el.addEventListener('click', () => viewUserProfile(el.dataset.userId));
                });
            });
        }
        
        // Toggle like on post
        function toggleLike(postId) {
            const postRef = database.ref('posts/' + postId + '/likes/' + currentUser.uid);
            postRef.once('value').then(snapshot => {
                if (snapshot.exists()) {
                    postRef.remove();
                } else {
                    postRef.set(true);
                }
            });
        }
        
        // Load comments for a post
        function loadComments(postId, commentsList) {
            database.ref('posts/' + postId + '/comments').orderByChild('timestamp').limitToLast(10).once('value').then(snapshot => {
                const commentsData = snapshot.val();
                commentsList.innerHTML = '';
                
                if (commentsData) {
                    Object.keys(commentsData).forEach(commentId => {
                        const comment = commentsData[commentId];
                        const commentDate = new Date(comment.timestamp);
                        const author = users[comment.authorId] || { displayName: comment.author };
                        
                        const commentElement = document.createElement('div');
                        commentElement.className = 'comment';
                        commentElement.innerHTML = `
                            <div class="comment-avatar" data-user-id="${comment.authorId}">${author.displayName.charAt(0).toUpperCase()}</div>
                            <div class="comment-content">
                                <div class="comment-user" data-user-id="${comment.authorId}">${author.displayName}</div>
                                <div class="comment-text">${comment.text}</div>
                                <div class="comment-time">${formatTime(commentDate)}</div>
                            </div>
                        `;
                        
                        commentsList.appendChild(commentElement);
                        
                        // User avatar/name click
                        commentElement.querySelectorAll('[data-user-id]').forEach(el => {
                            el.addEventListener('click', () => viewUserProfile(el.dataset.userId));
                        });
                    });
                } else {
                    commentsList.innerHTML = '<p class="text-center">Nenhum comentário ainda</p>';
                }
            });
        }
        
        // Add comment to post
        function addComment(postId, commentText) {
            const newComment = {
                authorId: currentUser.uid,
                author: currentUser.displayName || 'Anônimo',
                text: commentText,
                timestamp: Date.now()
            };
            
            database.ref('posts/' + postId + '/comments').push(newComment);
        }
        
        // Load friends list
        function loadFriendsList() {
            friendsList.innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';
            
            // Get all users except current user
            database.ref('users').once('value').then(snapshot => {
                const allUsers = snapshot.val() || {};
                let friendsHtml = '';
                
                // Add pending friend requests first
                if (friendRequests.length > 0) {
                    friendsHtml += '<h3 style="margin: 15px 0 10px;">Solicitações de Amizade</h3>';
                    
                    friendRequests.forEach(requestId => {
                        const user = allUsers[requestId];
                        if (user) {
                            friendsHtml += createFriendCard(requestId, user, 'pending');
                        }
                    });
                }
                
                // Add current friends
                if (friends.length > 0) {
                    friendsHtml += '<h3 style="margin: 15px 0 10px;">Seus Amigos</h3>';
                    
                    friends.forEach(friendId => {
                        const user = allUsers[friendId];
                        if (user) {
                            friendsHtml += createFriendCard(friendId, user, 'friend');
                        }
                    });
                }
                
                // Add other users
                const otherUsers = Object.keys(allUsers)
                    .filter(uid => uid !== currentUser.uid && 
                          !friends.includes(uid) && 
                          !friendRequests.includes(uid));
                
                if (otherUsers.length > 0) {
                    friendsHtml += '<h3 style="margin: 15px 0 10px;">Adicionar Amigos</h3>';
                    
                    otherUsers.forEach(uid => {
                        const user = allUsers[uid];
                        friendsHtml += createFriendCard(uid, user, 'add');
                    });
                }
                
                if (friendRequests.length === 0 && friends.length === 0 && otherUsers.length === 0) {
                    friendsHtml = '<p class="text-center">Nenhum usuário encontrado</p>';
                }
                
                friendsList.innerHTML = friendsHtml;
                
                // Add event listeners to buttons
                document.querySelectorAll('.friend-button').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const userId = button.dataset.userId;
                        const action = button.dataset.action;
                        
                        if (action === 'add') {
                            sendFriendRequest(userId);
                        } else if (action === 'accept') {
                            acceptFriendRequest(userId);
                        } else if (action === 'remove') {
                            removeFriend(userId);
                        } else if (action === 'message') {
                            startConversation(userId);
                        }
                    });
                });
                
                // Add event listeners to user names/avatars
                document.querySelectorAll('[data-user-id]').forEach(el => {
                    el.addEventListener('click', () => viewUserProfile(el.dataset.userId));
                });
            });
        }
        
        // Create friend card HTML
        function createFriendCard(userId, user, type) {
            let actionsHtml = '';
            
            if (type === 'pending') {
                actionsHtml = `
                    <button class="friend-button primary" data-user-id="${userId}" data-action="accept">Aceitar</button>
                    <button class="friend-button secondary" data-user-id="${userId}" data-action="remove">Recusar</button>
                `;
            } else if (type === 'friend') {
                actionsHtml = `
                    <button class="friend-button primary" data-user-id="${userId}" data-action="message">Mensagem</button>
                    <button class="friend-button secondary" data-user-id="${userId}" data-action="remove">Remover</button>
                `;
            } else if (type === 'add') {
                actionsHtml = `
                    <button class="friend-button primary" data-user-id="${userId}" data-action="add">Adicionar</button>
                `;
            }
            
            return `
                <div class="friend-card">
                    <div class="friend-avatar" data-user-id="${userId}">${user.displayName ? user.displayName.charAt(0).toUpperCase() : 'U'}</div>
                    <div class="friend-info">
                        <div class="friend-name" data-user-id="${userId}">${user.displayName || 'Usuário'}</div>
                        <div class="friend-class">${getClassName(user.class)}</div>
                    </div>
                    <div class="friend-actions">
                        ${actionsHtml}
                    </div>
                </div>
            `;
        }
        
        // Send friend request
        function sendFriendRequest(userId) {
            database.ref('friendRequests/' + userId + '/' + currentUser.uid).set('pending');
            alert('Solicitação de amizade enviada!');
        }
        
        // Accept friend request
        function acceptFriendRequest(userId) {
            // Add to friends list for both users
            database.ref('friends/' + currentUser.uid + '/' + userId).set('accepted');
            database.ref('friends/' + userId + '/' + currentUser.uid).set('accepted');
            
            // Remove the request
            database.ref('friendRequests/' + currentUser.uid + '/' + userId).remove();
            
            alert('Agora vocês são amigos!');
            loadFriendsList();
        }
        
        // Remove friend
        function removeFriend(userId) {
            if (confirm('Tem certeza que deseja remover este amigo?')) {
                // Remove from friends list for both users
                database.ref('friends/' + currentUser.uid + '/' + userId).remove();
                database.ref('friends/' + userId + '/' + currentUser.uid).remove();
                
                alert('Amigo removido');
                loadFriendsList();
            }
        }
        
        // Load communities list
        function loadCommunitiesList() {
            communitiesList.innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';
            
            database.ref('communities').once('value').then(snapshot => {
                const communitiesData = snapshot.val();
                
                if (communitiesData) {
                    let html = '';
                    
                    Object.keys(communitiesData).forEach(communityId => {
                        const community = communitiesData[communityId];
                        const isMember = communities.includes(communityId);
                        
                        html += `
                            <div class="community-card" data-community-id="${communityId}">
                                <div class="community-icon">
                                    <i class="material-icons">groups</i>
                                </div>
                                <div class="community-info">
                                    <div class="community-name">${community.name}</div>
                                    <div class="community-members">${community.members ? Object.keys(community.members).length : 0} membros</div>
                                </div>
                                ${isMember ? '' : '<button class="friend-button primary join-community" data-community-id="' + communityId + '">Participar</button>'}
                            </div>
                        `;
                    });
                    
                    communitiesList.innerHTML = html;
                    
                    // Add event listeners to join buttons
                    document.querySelectorAll('.join-community').forEach(button => {
                        button.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const communityId = button.dataset.communityId;
                            joinCommunity(communityId);
                        });
                    });
                    
                    // Add event listeners to community cards
                    document.querySelectorAll('.community-card').forEach(card => {
                        card.addEventListener('click', () => {
                            const communityId = card.dataset.communityId;
                            viewCommunity(communityId);
                        });
                    });
                } else {
                    communitiesList.innerHTML = '<p class="text-center">Nenhuma comunidade encontrada</p>';
                }
            });
        }
        
        // Create new community
        function createCommunity() {
            const name = communityNameInput.value.trim();
            if (!name) {
                alert('Digite um nome para a comunidade');
                return;
            }
            
            const newCommunity = {
                name: name,
                creator: currentUser.uid,
                createdAt: Date.now()
            };
            
            database.ref('communities').push(newCommunity).then(ref => {
                // Add creator as member
                database.ref('communities/' + ref.key + '/members/' + currentUser.uid).set(true);
                database.ref('userCommunities/' + currentUser.uid + '/' + ref.key).set(true);
                
                communityNameInput.value = '';
                alert('Comunidade criada com sucesso!');
                loadCommunitiesList();
            });
        }
        
        // Join community
        function joinCommunity(communityId) {
            database.ref('communities/' + communityId + '/members/' + currentUser.uid).set(true);
            database.ref('userCommunities/' + currentUser.uid + '/' + communityId).set(true);
            alert('Você agora é membro desta comunidade!');
            loadCommunitiesList();
        }
        
        // View community (placeholder - would show community feed)
        function viewCommunity(communityId) {
            alert('Visualizando comunidade ' + communityId);
            // In a full implementation, this would show the community feed
        }
        
        // Load conversations list
        function loadConversationsList() {
            conversationsList.innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';
            
            if (Object.keys(conversations).length === 0) {
                conversationsList.innerHTML = '<p class="text-center">Nenhuma conversa encontrada</p>';
                return;
            }
            
            let html = '';
            
            Object.keys(conversations).forEach(conversationId => {
                const conversation = conversations[conversationId];
                const otherUserId = conversation.members.find(member => member !== currentUser.uid);
                const otherUser = users[otherUserId];
                
                if (otherUser) {
                    const lastMessageDate = conversation.lastMessage ? new Date(conversation.lastMessage.timestamp) : null;
                    
                    html += `
                        <div class="friend-card" data-conversation-id="${conversationId}">
                            <div class="friend-avatar" data-user-id="${otherUserId}">${otherUser.displayName ? otherUser.displayName.charAt(0).toUpperCase() : 'U'}</div>
                            <div class="friend-info">
                                <div class="friend-name" data-user-id="${otherUserId}">${otherUser.displayName || 'Usuário'}</div>
                                <div class="friend-class">${lastMessageDate ? formatTime(lastMessageDate) : 'Nenhuma mensagem'}</div>
                            </div>
                        </div>
                    `;
                }
            });
            
            conversationsList.innerHTML = html;
            
            // Add event listeners to conversation cards
            document.querySelectorAll('[data-conversation-id]').forEach(card => {
                card.addEventListener('click', () => {
                    const conversationId = card.dataset.conversationId;
                    openConversation(conversationId);
                });
            });
            
            // Add event listeners to user names/avatars
            document.querySelectorAll('[data-user-id]').forEach(el => {
                el.addEventListener('click', (e) => {
                    e.stopPropagation();
                    viewUserProfile(el.dataset.userId);
                });
            });
        }
        
        // Start new conversation
        function startConversation(userId) {
            // Check if conversation already exists
            let existingConversationId = null;
            
            Object.keys(conversations).forEach(conversationId => {
                if (conversations[conversationId].members.includes(userId)) {
                    existingConversationId = conversationId;
                }
            });
            
            if (existingConversationId) {
                openConversation(existingConversationId);
            } else {
                // Create new conversation
                const newConversation = {
                    members: [currentUser.uid, userId],
                    createdAt: Date.now()
                };
                
                database.ref('conversations').push(newConversation).then(ref => {
                    // Add to user conversations
                    database.ref('userConversations/' + currentUser.uid + '/' + ref.key).set({
                        members: newConversation.members,
                        lastMessage: null
                    });
                    
                    database.ref('userConversations/' + userId + '/' + ref.key).set({
                        members: newConversation.members,
                        lastMessage: null
                    });
                    
                    openConversation(ref.key);
                });
            }
        }
        
        // Open conversation
        function openConversation(conversationId) {
            currentConversation = conversationId;
            const conversation = conversations[conversationId];
            const otherUserId = conversation.members.find(member => member !== currentUser.uid);
            const otherUser = users[otherUserId];
            
            if (otherUser) {
                conversationTitle.textContent = otherUser.displayName || 'Usuário';
                
                // Show conversation page
                chatPage.classList.add('hidden');
                conversationPage.classList.remove('hidden');
                
                // Load messages
                loadMessages(conversationId);
            }
        }
        
        // Load messages for conversation
        function loadMessages(conversationId) {
            chatMessages.innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';
            
            database.ref('conversations/' + conversationId + '/messages').orderByChild('timestamp').limitToLast(50).once('value').then(snapshot => {
                const messagesData = snapshot.val();
                chatMessages.innerHTML = '';
                
                if (messagesData) {
                    Object.keys(messagesData).forEach(messageId => {
                        const message = messagesData[messageId];
                        const messageDate = new Date(message.timestamp);
                        
                        const messageElement = document.createElement('div');
                        messageElement.className = `message ${message.senderId === currentUser.uid ? 'message-sent' : 'message-received'}`;
                        messageElement.innerHTML = `
                            <div class="message-text">${message.text}</div>
                            <div class="message-time">${formatTime(messageDate)}</div>
                        `;
                        
                        chatMessages.appendChild(messageElement);
                    });
                    
                    // Scroll to bottom
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                } else {
                    chatMessages.innerHTML = '<p class="text-center">Nenhuma mensagem ainda</p>';
                }
            });
            
            // Set up real-time listener for new messages
            database.ref('conversations/' + conversationId + '/messages').orderByChild('timestamp').limitToLast(1).on('child_added', snapshot => {
                const message = snapshot.val();
                if (message.senderId !== currentUser.uid) {
                    const messageDate = new Date(message.timestamp);
                    
                    const messageElement = document.createElement('div');
                    messageElement.className = 'message message-received';
                    messageElement.innerHTML = `
                        <div class="message-text">${message.text}</div>
                        <div class="message-time">${formatTime(messageDate)}</div>
                    `;
                    
                    chatMessages.appendChild(messageElement);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }
            });
        }
        
        // Send message
        function sendMessage() {
            const text = messageInput.value.trim();
            if (!text || !currentConversation) return;
            
            const newMessage = {
                senderId: currentUser.uid,
                text: text,
                timestamp: Date.now()
            };
            
            // Add message to conversation
            database.ref('conversations/' + currentConversation + '/messages').push(newMessage).then(() => {
                // Update last message in user conversations
                const conversation = conversations[currentConversation];
                const otherUserId = conversation.members.find(member => member !== currentUser.uid);
                
                database.ref('userConversations/' + currentUser.uid + '/' + currentConversation + '/lastMessage').set(newMessage);
                database.ref('userConversations/' + otherUserId + '/' + currentConversation + '/lastMessage').set(newMessage);
                
                messageInput.value = '';
                
                // Add to UI
                const messageDate = new Date(newMessage.timestamp);
                const messageElement = document.createElement('div');
                messageElement.className = 'message message-sent';
                messageElement.innerHTML = `
                    <div class="message-text">${newMessage.text}</div>
                    <div class="message-time">${formatTime(messageDate)}</div>
                `;
                
                chatMessages.appendChild(messageElement);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            });
        }
        
        // View user profile
        function viewUserProfile(userId) {
            // In a full implementation, this would show the user's profile page
            alert('Visualizando perfil do usuário ' + userId);
        }
        
        // Edit profile
        function editProfile() {
            profilePage.classList.add('hidden');
            editProfilePage.classList.remove('hidden');
            pageTitle.textContent = 'Editar Perfil';
        }
        
        // Save profile changes
        function saveProfile() {
            const newName = editNameInput.value.trim();
            const newClass = editClassSelect.value;
            
            if (!newName) {
                alert('Digite seu nome');
                return;
            }
            
            // Update user profile in Firebase Auth
            currentUser.updateProfile({
                displayName: newName
            }).then(() => {
                // Update user data in database
                const updates = {
                    'users/' + currentUser.uid + '/displayName': newName,
                    'users/' + currentUser.uid + '/class': newClass
                };
                
                database.ref().update(updates).then(() => {
                    // Update UI
                    updateUserInfo(currentUser);
                    profileClass.textContent = getClassName(newClass);
                    
                    // Go back to profile page
                    editProfilePage.classList.add('hidden');
                    profilePage.classList.remove('hidden');
                    pageTitle.textContent = 'Perfil';
                    
                    alert('Perfil atualizado com sucesso!');
                });
            }).catch(error => {
                alert('Erro ao atualizar perfil: ' + error.message);
            });
        }
        
        // Format time for display
        function formatTime(date) {
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) { // Less than 1 minute
                return 'Agora';
            } else if (diff < 3600000) { // Less than 1 hour
                const minutes = Math.floor(diff / 60000);
                return `${minutes} min atrás`;
            } else if (diff < 86400000) { // Less than 1 day
                const hours = Math.floor(diff / 3600000);
                return `${hours} h atrás`;
            } else if (diff < 604800000) { // Less than 1 week
                const days = Math.floor(diff / 86400000);
                return `${days} d atrás`;
            } else {
                return date.toLocaleDateString('pt-BR');
            }
        }
        
        // Event Listeners
        showRegister.addEventListener('click', () => {
            authScreen.classList.add('hidden');
            registerScreen.classList.remove('hidden');
        });
        
        showLogin.addEventListener('click', () => {
            authScreen.classList.remove('hidden');
            registerScreen.classList.add('hidden');
        });
        
        loginForm.addEventListener('submit', e => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            auth.signInWithEmailAndPassword(email, password)
                .catch(error => {
                    alert('Erro ao fazer login: ' + error.message);
                });
        });
        
        registerForm.addEventListener('submit', e => {
            e.preventDefault();
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirm = document.getElementById('register-confirm').value;
            const classNum = document.getElementById('register-class').value;
            
            if (password !== confirm) {
                alert('As senhas não coincidem!');
                return;
            }
            
            if (!classNum) {
                alert('Selecione sua turma');
                return;
            }
            
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Update user profile
                    return userCredential.user.updateProfile({
                        displayName: name
                    }).then(() => {
                        // Save additional user data to database
                        const userData = {
                            displayName: name,
                            email: email,
                            class: classNum,
                            joinDate: Date.now()
                        };
                        
                        return database.ref('users/' + userCredential.user.uid).set(userData);
                    });
                })
                .catch(error => {
                    alert('Erro ao registrar: ' + error.message);
                });
        });
        
        googleLogin.addEventListener('click', () => {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider)
                .then((result) => {
                    // Check if user is new
                    if (result.additionalUserInfo.isNewUser) {
                        // Prompt for class selection
                        const classNum = prompt('Por favor, selecione sua turma:\n7 para 7ª Classe\n8 para 8ª Classe\n...\n12 para 12ª Classe');
                        
                        if (classNum && ['7','8','9','10','11','12'].includes(classNum)) {
                            // Save user data to database
                            const userData = {
                                displayName: result.user.displayName,
                                email: result.user.email,
                                class: classNum,
                                joinDate: Date.now()
                            };
                            
                            return database.ref('users/' + result.user.uid).set(userData);
                        } else {
                            // If no valid class selected, delete the user
                            result.user.delete();
                            throw new Error('Por favor, selecione uma turma válida (7-12)');
                        }
                    }
                })
                .catch(error => {
                    alert('Erro ao fazer login com Google: ' + error.message);
                });
        });
        
        logoutButton.addEventListener('click', () => {
            auth.signOut();
        });
        
        menuButton.addEventListener('click', () => {
            drawer.classList.add('open');
            overlay.classList.add('visible');
        });
        
        overlay.addEventListener('click', () => {
            drawer.classList.remove('open');
            overlay.classList.remove('visible');
        });
        
        // Menu item clicks
        menuItems.forEach(item => {
            item.addEventListener('click', () => {
                const page = item.dataset.page;
                showPage(page);
                drawer.classList.remove('open');
                overlay.classList.remove('visible');
            });
        });
        
        // Nav item clicks
        navItems.forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const page = item.dataset.page;
                showPage(page);
            });
        });
        
        // Chat back buttons
        chatBackButton.addEventListener('click', () => {
            showPage('chat');
        });
        
        conversationBackButton.addEventListener('click', () => {
            conversationPage.classList.add('hidden');
            chatPage.classList.remove('hidden');
        });
        
        // Create post
        createPostButton.addEventListener('click', () => {
            const content = postInput.value.trim();
            if (!content) return;
            
            const newPost = {
                authorId: currentUser.uid,
                author: currentUser.displayName || 'Anônimo',
                content: content,
                timestamp: Date.now()
            };
            
            database.ref('posts').push(newPost).then(() => {
                postInput.value = '';
            });
        });
        
        // Create community
        createCommunityButton.addEventListener('click', createCommunity);
        
        // Send message
        sendMessageButton.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        // Edit profile
        editProfileButton.addEventListener('click', editProfile);
        
        // Save profile
        editProfileForm.addEventListener('submit', (e) => {
            e.preventDefault();
            saveProfile();
        });
        
        // Search friends
        searchFriendsInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            if (searchTerm) {
                document.querySelectorAll('.friend-card').forEach(card => {
                    const name = card.querySelector('.friend-name').textContent.toLowerCase();
                    if (name.includes(searchTerm)) {
                        card.style.display = 'flex';
                    } else {
                        card.style.display = 'none';
                    }
                });
            } else {
                document.querySelectorAll('.friend-card').forEach(card => {
                    card.style.display = 'flex';
                });
            }
        });
        
        // Initialize the app
        initApp();
    </script>
</body>
</html>
